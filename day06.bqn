uâ†â€¢Import "util.bqn"
xâ†u.Lines u.GetContents @
Râ†4âŠ¸|+âŸœ1 â‹„ Doâ†âŠ£(1+âŠ‘Ëœ)âŠ@(âŠ‘Â¯1+â‹) â‹„ Upâ†âŠ£(Â¯1+âŠ‘Ëœ)âŠ@(âŠ‘â‹) â‹„ Finiteâ†âˆ§Â´(âˆâ‰ |)
Goâ†{rowsâ€¿cols ğ•Š iâ€¿jâ€¿d: vâ†2|d â‹„ iâ€¿jâ†©vâŒ½iâ€¿j â‹„ aâ†iâŠ‘vâŠ‘rowsâ€¿cols â‹„ bâ†a (dâ‰¥2)â—¶Doâ€¿Up j â‹„ (vâŒ½iâ€¿b)âˆ¾R d}

# Process the input
rowsâ€¿colsâ†{Â¯âˆâˆ¾ğ•©âˆ¾âˆ}âˆ˜/âš‡1<Ë˜Â¨â‹ˆâŸœâ‰>'#'=x
startâ†((/âˆ¨Â´Â¨)âˆ¾(âˆ¾/Â¨))'^'=x

# Part 1
visitedâ†0Â¨>x
pâ†Â¯1âŠ¸â†“Â¨ rowsâ€¿cols {ğ•©âˆ¾<ğ•¨ Go Â¯1âŠ‘ğ•©} â€¢_while_ {Finite Â¯1âŠ‘ğ•©} âŸ¨startâˆ¾1âŸ©
(Â¯1â†“p) {minâ†0âŒˆğ•¨âŒŠğ•© â‹„ maxâ†(Â¯1+â‰ x)âŒŠğ•¨âŒˆğ•© â‹„ iâ†minâŠ¸+Â¨â¥Šâ†•1â€¿1+max-min â‹„ visited 1Â¨âŒ¾(iâŠ¸âŠ‘)â†©}Â¨ (1â†“p)
â€¢Show +Â´â¥Švisited

# Part 2
â€¢Show +Â´ {ğ•Š iâ€¿j:
  seenâ†â€¢HashMapËœâŸ¨âŸ©
  Finite âŸ¨{âˆ§jâˆ¾ğ•©}âŒ¾(iâŠ¸âŠ‘)rows, {âˆ§iâˆ¾ğ•©}âŒ¾(jâŠ¸âŠ‘)colsâŸ© {seen.SetËœğ•© â‹„ ğ•¨ Go ğ•©} â€¢_while_ {(Â¬seen.Has ğ•©) âˆ§ Finite ğ•©} startâˆ¾1
}Â¨ visited/â—‹â¥Šâ†•â‰¢visited
